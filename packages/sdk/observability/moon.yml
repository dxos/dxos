type: library
language: typescript
tags:
  - ts-build
  - ts-test
  - pack
tasks:
  compile:
    args:
      - '--entryPoint=src/index.ts'
      - '--entryPoint=src/segment/index.ts'
      - '--entryPoint=src/segment/browser.ts'
      - '--entryPoint=src/segment/node.ts'
      - '--entryPoint=src/sentry/index.ts'
      - '--entryPoint=src/sentry/browser.ts'
      - '--entryPoint=src/sentry/node.ts'
      - '--entryPoint=src/otel/traces.ts'
      - '--entryPoint=src/otel/traces-browser.ts'
      - '--entryPoint=src/testing/testkit/index.ts'
      - '--entryPoint=src/testing/testkit/browser.ts'
    deps:
      - prebuild
  prebuild:
    command: node ./scripts/inject_api_keys.mjs
    inputs:
      - scripts/inject_api_keys.mjs
      - $DX_IPDATA_API_KEY
      - $DX_OTEL_ENDPOINT
      - $DX_OTEL_AUTHORIZATION
      - $DX_SENTRY_DESTINATION
      - $DX_TELEMETRY_API_KEY
      - $NODE_ENV
    outputs:
      - src/cli-observability-secrets.json
