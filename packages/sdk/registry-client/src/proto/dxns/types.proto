//
// Copyright 2021 DXOS.org
//

syntax = "proto3";

import "registry.proto";

package dxos.type;

//
// Records
//

//
// Registered as `type.app`.
//
message App {
  /**
   * Type of application (ex. web app, android apk, etc.)
   * Should align with types of files in the bundle.
   */
  string type = 1;

  /**
   * Optional **semver 2.0** compliant record version.
   * Should conform to the semver regex (see https://semver.org/).
   */
  string version = 2;

  /// App bundle content Id in the CID v0 format (https://docs.ipfs.io/concepts/content-addressing/#identifier-formats).
  bytes bundleCID = 3;
  string repository = 4;
  string repository_version = 5; // TODO(wittjosiah): Align with config?
  string license = 6;

  Record.Extension extension = 100;
}

//
// Registered as `type.app.web`.
//
message WebApp {
  /// Optional app root path, defaults to index.html.
  string root = 1;

  Record.Extension extension = 100;
}

//
// Registered as `type.app.frame`.
//
message Frame {
  /// Optional relative path in bundle to frame entrypoint, defaults to frame.js.
  string module = 1;

  /// Optional default item type which frame loads and creates, defaults to name of the frame.
  string item = 2;

  Record.Extension extension = 100;
}

//
// Registered as `type.bot`.
//
message Bot {
  /**
   * Optional **semver 2.0** compliant record version.
   * Should conform to the semver regex (see https://semver.org/).
   */
  string version = 1;

  /// Bot bundle content Id in the CID v0 format (https://docs.ipfs.io/concepts/content-addressing/#identifier-formats).
  bytes bundleCID = 2;
  string repository = 3;
  string repository_version = 4;
  string license = 5;

  /// Only for spawning bots that are expected to be vendored with bot-factory.
  /// This would be the path to the bot executable in bot-factory's file-system.
  string local_path = 6;

  Record.Extension extension = 100;
}

//
// Registered as `type.state-machine`.
//
message StateMachine {
  /// Set of protobuf messages encoded in JSON.
  string mutation_protobuf_defs = 1;

  /// Set of protobuf messages encoded in JSON.
  string snapshot_protobuf_defs = 2;

  bytes code_ipfs_cid = 3;
}

//
// Registered as `type.file`.
//
message File {
  // MIME type of the file content: https://developer.mozilla.org/en-US/docs/Glossary/MIME_type.
  string content_type = 1;
  string file_name = 2;

  /// File content Id in the CID v0 format (https://docs.ipfs.io/concepts/content-addressing/#identifier-formats).
  bytes hash = 3;

  Record.Extension extension = 100;
}

//
// Registered as `type.kube`.
//
message KUBE {
  string url = 1;

  Record.Extension extension = 100;
}

//
// Registered as `type.service`.
//
message Service {
  // TODO(dmaretskyi): How are service type's defined?
  string type = 1;

  // KUBE record's CID that hosts this service.
  bytes kube = 2;

  // Extension field's payload depends on service type and has extra data specific to that service.
  // Within this schema extension might be `type.service.ipfs` or `type.service.bot-factory`.
  Record.Extension extension = 100;
}

//
// Registered as `type.service.ipfs`.
//
message IPFS {
  string protocol = 1;
  repeated string addresses = 2;

  Record.Extension extension = 100;
}

//
// Registered as `type.service.bot-factory`.
//
message BotFactory {
  string topic = 1;

  Record.Extension extension = 100;
}

//
// Registered as `type.service.signal`.
//
message Signal {
  string bootstrap = 1;
  string url = 2;

  Record.Extension extension = 100;
}

//
// Registered as `type.service.app-server`.
//
message AppServer {
  string url = 1;

  Record.Extension extension = 100;
}
