//
// Copyright 2022 DXOS.org
//

import React from 'react';
import { useOutletContext } from 'react-router-dom';

import type { Space } from '@dxos/client';
import { useQuery } from '@dxos/react-client';
import { Loading } from '@dxos/react-components';

import { TaskListComponent } from '../components/TaskList';
import { Task, TaskList } from '../proto';

/**
 * Lay out a single task list per space.
 * @returns JSX
 */
export const SpacePage = () => {
  const { space } = useOutletContext<{ space: Space }>();
  const [taskList] = useQuery(space, { '@type': 'model/object' });
  if (!taskList) {
    return <Loading label='loading' />;
  }
  return (
    <TaskListComponent
      taskList={taskList}
      onTitleChanged={(title) => {
        taskList.title = title;
        // void space.experimental.db.save(taskList);
      }}
      onTaskCreate={() => {
        const task = new Task();
        taskList.tasks.push(task);
      }}
      onTaskTitleChanged={(task, title) => {
        task.title = title;
      }}
      onTaskCompleteChanged={(task, completed) => {
        task.completed = completed;
      }}
      onTaskDeleted={(task) => {
        // taskList.tasks // ??
        // taskList.tasks.splice();
        void space.experimental.db.delete(task);
      }}
    />
  );
};
