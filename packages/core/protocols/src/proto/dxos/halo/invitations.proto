//
// Copyright 2021 DXOS.org
//

syntax = "proto3";

import "google/protobuf/empty.proto";

import "dxos/keys.proto";

package dxos.halo.invitations;

message InvitationDescriptor {
  enum Type {
    /// Both peers online at the same time.
    INTERACTIVE = 0;
    /// Invited peer's public key is known and invitation can be accepted by any valid peer.
    OFFLINE = 1;
  }

  Type type = 1;

  /// Topic for network handshake.
  bytes swarm_key = 2;

  /// TODO(burdon): Remove?
  bytes invitation = 3;

  /// Only present if type === OFFLINE.
  optional bytes identity_key = 4;

  /// Must be stripped out when passing to another peer.
  optional bytes secret = 5;
}

//
// HALO device invitations.
//

// TODO(burdon): ALL invitation messages should be handled over encrypted sessions.
// TODO(burdon): Or contain some form of signed credential.
// TODO(burdon): Calls should include some request context (e.g., halo/space key).

message HaloAdmissionCredentials {
  dxos.keys.PublicKey device_key = 1;
  dxos.keys.PublicKey control_feed_key = 2;
  dxos.keys.PublicKey data_feed_key = 3;
}

message HaloAdmissionOffer {
  dxos.keys.PublicKey identity_key = 1;
  dxos.keys.PublicKey halo_space_key = 2;
  dxos.keys.PublicKey genesis_feed_key = 3;
}

service HaloHostService {
  /// Process admission request from guest.
  rpc PresentAdmissionCredentials(HaloAdmissionCredentials) returns (google.protobuf.Empty);
}

service HaloGuestService {
  /// Process admission offer from host.
  rpc PresentAdmissionOffer(HaloAdmissionOffer) returns (google.protobuf.Empty);
}

//
// Space agent invitations.
//

message SpaceAdmissionCredentials {
  dxos.keys.PublicKey identity_key = 1;
  dxos.keys.PublicKey device_key = 2;
  dxos.keys.PublicKey control_feed_key = 3;
  dxos.keys.PublicKey data_feed_key = 4;
}

message SpaceAdmissionOffer {
  dxos.keys.PublicKey space_key = 1;
  dxos.keys.PublicKey genesis_feed_key = 3;
}

service SpaceHostService {
  /// Process admission request from guest.
  rpc PresentAdmissionCredentials(SpaceAdmissionCredentials) returns (google.protobuf.Empty);
}

service SpaceGuestService {
  /// Process admission offer from host.
  rpc PresentAdmissionOffer(SpaceAdmissionOffer) returns (google.protobuf.Empty);
}
