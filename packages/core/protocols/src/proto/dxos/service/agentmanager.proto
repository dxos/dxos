//
// Copyright 2022 DXOS.org
//

syntax = "proto3";

import "google/protobuf/any.proto";
import "google/protobuf/empty.proto";
import "dxos/config.proto";
import "dxos/halo/credentials.proto";
import "dxos/keys.proto";

package dxos.service.agentmanager;

option go_package = "github.com/dxos/kube/proto/def/dxos/service/agentmanager";

message InitAuthSequenceRequest {
  // Auth token for the agentmanager to validate authorization.
  // TODO: any?
  optional string auth_token = 1;
}
message InitAuthSequenceResponse {
  enum InitAuthSequenceResult {
    UNKNOWN = 0;
      SUCCESS = 1;
      NOT_AUTHORIZED = 2;
      ERROR = 3;
  }
  InitAuthSequenceResult result = 1;
    optional bytes nonce = 2;
    optional dxos.keys.PublicKey agentmanager_key = 3;
    // Reason why initializing the auth sequence failed (e.g. invalid access token)
    optional string init_auth_response_reason = 4;
}

message Authentication {
    dxos.halo.credentials.Presentation presentation = 1;
}

message AuthenticateResponse {
    optional string token = 1;
    optional dxos.halo.credentials.Credential credential = 2;
}

service AgentManager {
    // Authenticate with KUBE.
    rpc Authenticate(Authentication) returns (AuthenticateResponse);

    // Init authentication sequence. Used to obtain nonce & KUBE identity (public key).
    rpc InitAuthSequence(InitAuthSequenceRequest) returns (InitAuthSequenceResponse);

   //rpc RegisterIdentity(RegistrationRequest) returns (RegistrationResponse);
}
