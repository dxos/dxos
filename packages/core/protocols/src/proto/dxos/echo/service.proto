//
// Copyright 2021 DXOS.org
//

syntax = "proto3";

import "dxos/echo/object.proto";
import "dxos/echo/snapshot.proto";
import "dxos/echo/timeframe.proto";
import "dxos/keys.proto";

package dxos.echo.service;

message SubscribeRequest {
  dxos.keys.PublicKey space_key = 1;
}

message SubscribeResponse {
  // TODO(dmaretskyi): Use batch message.
  repeated dxos.echo.object.EchoObject objects = 1;
}

message WriteRequest {
  dxos.keys.PublicKey space_key = 1;
  // TODO(dmaretskyi): Mutation batch.
  dxos.echo.object.EchoObject mutation = 2;
}

message MutationReceipt {
  dxos.keys.PublicKey feed_key = 1;
  int32 seq = 2;
}

service DataService {
  rpc Subscribe(SubscribeRequest) returns (stream SubscribeResponse);
  rpc Write(WriteRequest) returns (MutationReceipt); // TODO(burdon): Rename SubmitMutation.
}
