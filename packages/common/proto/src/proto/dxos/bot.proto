syntax = "proto3";

import "google/protobuf/empty.proto";
import "./client.proto";

package dxos.bot;

message BotPackageSpecifier {
  oneof kind {
    string dxn = 1;
    string ipfs_cid = 2;
    string local_path = 3;
  }
}

message Bot {
  enum Status {
    STOPPED = 0;
    RUNNING = 1;
  }

  string id = 1;
  Status status = 2;
}

message GetBotsResponse {
  repeated Bot bots = 1;
}

message SpawnBotRequest {
  BotPackageSpecifier package = 1;

  /// Invitation for the bot to join the target party.
  dxos.client.Invitation invitation = 2;
}

message SendCommandRequest {
  string bot_id = 1;

  bytes command = 2;
}

/// Service that is used by clients to communicate with bot factory.
service BotFactoryService {
  rpc GetBots(google.protobuf.Empty) returns (GetBotsResponse);

  rpc SpawnBot(SpawnBotRequest) returns (Bot);
 
  // TODO(dmaretskyi): Invitations.

  rpc Start(Bot) returns (Bot);
  rpc Stop(Bot) returns (Bot);
  rpc Remove(Bot) returns (google.protobuf.Empty);
 
  // TODO(dmaretskyi): querying metrics/state.
 
  rpc SendCommand(SendCommandRequest) returns (google.protobuf.Empty);
}

message InitializeRequest {
  // TODO(dmaretskyi): Use actuall config protobufs.
  string config = 1;

  /// Invitation for the bot to join the target party.
  dxos.client.Invitation invitation = 2;
}

/// Service that is used by bots communicating with bot factory.
service BotService {
  /// Initialize Client, create profile, and join a party.
  rpc Initialize(InitializeRequest) returns (google.protobuf.Empty);

  /// Custom commands sent to the bot factory.
  rpc Command(SendCommandRequest) returns (google.protobuf.Empty);
}
