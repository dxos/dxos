type: library
language: typescript
tags:
  - ts-compile
  - pack
tasks:
  compile:
    deps:
      - prebuild
    inputs:
      - bin/main.js
  prebuild:
    command: vite-node ./src/main.ts --src ./test/proto/**/*.proto -s ./test/proto/substitutions.ts --baseDir ./test/proto -o ./test/proto/gen
    deps:
      - ^:build
    inputs:
      - test/proto/example/
    outputs:
      - test/proto/gen/
  test:
    command: pnpm run --silent test
    deps:
      - prebuild
      - ^:compile
    inputs:
      - '@group(sources)'
