layer: library
language: typescript
tags:
  - ts-build
  - ts-test
  - ts-test-storybook
  - pack
  - storybook
tasks:
  compile:
    args:
      - '--entryPoint=src/index.ts'
    deps:
      - compile-node
  compile-node:
    command: pnpm exec dx-compile
    args:
      - '--entryPoint=src/config/tailwind.ts'
      - '--entryPoint=src/plugins/esbuild-plugin.ts'
      - '--entryPoint=src/plugins/plugin.ts'
      - '--entryPoint=src/theme.css'
      - '--outputPath=dist/plugin'
      - '--moduleFormat=cjs'
      - '--moduleFormat=esm'
      - '--platform=node'
    deps:
      - ^:compile
      - dx-compile:compile
    options:
      mergeArgs: replace
    outputs:
      - dist/plugin/
  process-theme-css:
    command: node
    args:
      - 'scripts/process-theme-css.mjs'
    deps:
      - compile-node
    outputs:
      - dist/plugin/node-esm/theme.css
      - dist/plugin/node-cjs/theme.css
  test:
    deps:
      - compile-node
  test-storybook:
    deps:
      - compile-node
